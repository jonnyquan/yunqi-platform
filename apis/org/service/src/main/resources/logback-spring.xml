<?xml version="1.0" encoding="UTF-8"?>
<configuration>
	<include resource="org/springframework/boot/logging/logback/base.xml" />
	<conversionRule conversionWord="ip" converterClass="com.yunqi.logger.IpConvert" />
	<property name="ASYN_LOG_PATTERN" value="%ip [org] %d{yyyy-MM-dd HH:mm:ss.SSS} ${LOG_LEVEL_PATTERN:-%5p} ${PID:- } --- [%t] %-40.40logger{39} : %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}"/>
	<property name="LOG_FILE" value="/org.log"/>
	<logger name="com.yunqi" level="INFO" />
	
	<appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
		<encoder>
			<pattern>${FILE_LOG_PATTERN}</pattern>
		</encoder>
		<file>${LOG_FILE}</file>
		<rollingPolicy class="ch.qos.logback.core.rolling.FixedWindowRollingPolicy">
			<fileNamePattern>${LOG_FILE}.%i.zip</fileNamePattern>
		    <minIndex>1</minIndex>   
		    <maxIndex>10</maxIndex>
		</rollingPolicy>
		<triggeringPolicy class="ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy">
			<MaxFileSize>10MB</MaxFileSize>
		</triggeringPolicy>
	</appender>

	<appender name="REDIS" class="com.yunqi.logger.RedisAppender">
		<pusher class="com.yunqi.logger.RedisPusher">
			<host>114.215.103.189</host>
			<port>6379</port>
			<auth>bestaone</auth>
			<channel>yunqi.log.org</channel>
		</pusher>
		<layout class="ch.qos.logback.classic.PatternLayout">
			<pattern>${ASYN_LOG_PATTERN}</pattern>
		</layout>
	</appender>

	<appender name="ASYNCMQ" class="ch.qos.logback.classic.AsyncAppender">
		<appender-ref ref="REDIS" />
	</appender>

	<root level="INFO">
		<appender-ref ref="ASYNCMQ" />
	</root>
</configuration>